$schema: "1.0"
name: devbox-setup
image: microsoftwindowsdesktop_windows-ent-cpc_win11-24H2-ent-cpc

tasks:
  - name: ~/winget
    parameters:
      package: suse.RancherDesktop
      version: 1.7.0

  - name: ~/powershell
    parameters:
      command: |
        wsl --install -d Ubuntu-22.04

  - name: ~/powershell
    parameters:
      command: |
        # Install SQL Server Management Studio
        $ssmsInstallerUrl = "https://aka.ms/ssmsfullsetup"
        $installerPath = "$env:TEMP\SSMS-Setup.exe"

        # Download the installer
        Invoke-WebRequest -Uri $ssmsInstallerUrl -OutFile $installerPath

        # Install SQL Server Management Studio
        Start-Process -FilePath $installerPath -ArgumentList "/install", "/quiet", "/norestart" -Wait

        # Clean up the installer
        Remove-Item -Path $installerPath -Force
        # & "C:\path\to\scripts\install-ssms.ps1"

  - name: ~/powershell
    parameters:
      command: |
        $ErrorActionPreference = "Stop"

        # Define the NVM version and download URL
        $nvmVersion = "1.2.2"
        $nvmDownloadUrl = "https://github.com/coreybutler/nvm-windows/releases/download/$nvmVersion/nvm-setup.zip"

        # Define the installation path
        $installPath = "$env:ProgramFiles\nvm"

        # Download the NVM installer
        Invoke-WebRequest -Uri $nvmDownloadUrl -OutFile "$env:TEMP\nvm-setup.zip"

        # Extract the installer
        Expand-Archive -Path "$env:TEMP\nvm-setup.zip" -DestinationPath $env:TEMP

        # Run the installer
        Start-Process -FilePath "$env:TEMP\nvm-setup.exe" -ArgumentList "/S" -Wait

        # Clean up
        Remove-Item "$env:TEMP\nvm-setup.zip" -Force
        Remove-Item "$env:TEMP\nvm-setup.exe" -Force

        # Verify installation
        if (Test-Path "$installPath") {
            Write-Host "NVM installed successfully at $installPath"
        } else {
            Write-Host "NVM installation failed."
        }
        # & "C:\path\to\scripts\install-nvm.ps1"

  - name: ~/powershell
    parameters:
      command: |
        $dotnetVersion = "6.0.201"
        $dotnetInstallerUrl = "https://dotnet.microsoft.com/download/dotnet/thank-you/runtime-desktop-installer-$dotnetVersion-win-x64.exe"

        # Download the .NET SDK installer
        Invoke-WebRequest -Uri $dotnetInstallerUrl -OutFile "$env:TEMP\dotnet-installer.exe"

        # Install the .NET SDK
        Start-Process -FilePath "$env:TEMP\dotnet-installer.exe" -ArgumentList "/quiet", "/norestart" -Wait

        # Clean up the installer
        Remove-Item "$env:TEMP\dotnet-installer.exe" -Force

        # Verify installation
        dotnet --version

userTasks:
  - name: ~/powershell
    parameters:
      command: |
        # Additional user tasks can be added here.